#!/usr/bin/env bash

export PROJECT_MAIN_BIN="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
export PROJECT_MAIN_HOME=$(echo $PROJECT_MAIN_BIN | rev | cut -d"/" -f2- | rev)

export PATH="$PROJECT_MAIN_BIN:$PATH"
echo $PROJECT_MAIN_BIN added to \$PATH

$PROJECT_MAIN_BIN/clone-repos


export WEB_CONTEXT_PATH=web/
export API_CONTEXT_PATH=api/
export DOCKER_USER=$(id -u)
export DOCKER_GROUP=$(id -g)

# Get releases
source $PROJECT_MAIN_HOME/release.sh
export ENVIRONMENT=${ENVIRONMENT:=local}
export $API_TAG
export $WEB_TAG

echo "Running in ${ENVIRONMENT} environment"

exec "${@:-$SHELL}"